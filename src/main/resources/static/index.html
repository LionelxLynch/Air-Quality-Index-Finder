<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AQI Data Finder</title>
    <!-- Add Leaflet and jQuery library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" integrity="sha512-3KfDZl+8ZLeXf4j4s4sZWpT/CY8aPHIg2SjK1Jzyvn+/0A8dkvX9Q2mbrbhCI7VjKdl0Uf7kwUxFM6fbkNGCPA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js" integrity="sha512-m5M5Jy8/GgupK7AeR5+CTV7wwnBfVRJ9XQ2efoiF1mcLzKr6n+tU6h+vUhc/JrU6r/VaF+LeL9X4KOD4sZO4/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      #header {
        background-color: #3d3d3d;
        color: #ffffff;
        text-align: center;
        padding: 20px;
      }
      #content {
        max-width: 800px;
        margin: auto;
        padding: 20px;
      }
      #location-form {
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
      }
      label {
        margin-bottom: 10px;
      }
      input[type="text"] {
        padding: 10px;
        margin-bottom: 20px;
        border: none;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }
      input[type="submit"] {
        padding: 10px;
        border: none;
        border-radius: 5px;
        background-color: #0077cc;
        color: #ffffff;
        cursor: pointer;
      }
      input[type="submit"]:hover {
        background-color: #005ea2;
      }
      #aqi-result {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
      }
      #map {
        height: 500px;
        width: 100%;
        margin-bottom: 20px;
      }
    </style>
</head>
<body>
<h1>AQI Data Finder</h1>
<form id="location-form">
    <label for="lat">Latitude:</label>
    <input type="text" id="lat" name="lat"><br>

    <label for="lon">Longitude:</label>
    <input type="text" id="lon" name="lon"><br>

    <input type="submit" value="Submit">
</form>

<div id="aqi-result"></div>

<div id="map"></div>

<script>
      $(document).ready(function() {
        $("#location-form").submit(function(event) {
          // Prevent the form from submitting normally
          event.preventDefault();

          // Get the values of the lat and lon input fields
          var lat = $("#lat").val();
          var lon = $("#lon").val();

          // Make the AJAX call to the backend API endpoint
          $.ajax({
            type: "GET",
            url: "/aqi-data-finder",
            data: { lat: lat, lon: lon },
            success: function(result) {
              // Display the AQI result on the webpage
              $("#aqi-result").text("AQI: " + result);

              // Display the location on the map
              var map = L.map('map').setView([lat, lon], 13);

              L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
                maxZoom: 18,
              }).addTo(map);

              L.marker([lat, lon]).addTo(map)
                .bindPopup("Latitude: " + lat +
                           "<br>Longitude: " + lon)
                .openPopup();
            },
            error: function(xhr, status, error) {
              alert("An error occurred: " + xhr.responseText);
            }
          });
        });
      });
    </script>
</body>
</html>